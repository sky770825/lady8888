<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¾æ¥­å…±äº«å·¥ä½œå®¤è©¦ç®—å·¥å…·</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    background: linear-gradient(135deg, #f5f7fa, #e4ebf7);
    margin: 0; padding: 0;
    color: #333;
  }
  header {
    background: #2563eb;
    color: #fff;
    padding: 30px 20px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  main {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 15px;
  }
  h1, h2, h3 { margin-top: 0; }
  section {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(6px);
    border-radius: 14px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    padding: 25px 30px;
    margin-bottom: 30px;
  }
  .param-group { margin-bottom: 25px; }
  .param-title {
    font-weight: 700;
    font-size: 1.2rem;
    border-left: 5px solid #2563eb;
    padding-left: 10px;
    margin-bottom: 15px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
    gap: 20px 25px;
  }
  label {
    font-weight: 600;
    font-size: 0.9rem;
    display: block;
    margin-bottom: 6px;
  }
  input[type="number"] {
    width: 100%;
    padding: 12px 15px;
    font-size: 1.1rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #fff;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
  }
  input[type="number"]:focus {
    border-color: #2563eb;
    outline: none;
    box-shadow: 0 0 6px rgba(37,99,235,0.3);
  }
  button {
    background: #2563eb;
    color: #fff;
    padding: 14px 28px;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
  }
  button:hover { background: #1e4dc7; }

  .result-box {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 25px;
    margin-top: 25px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.08);
    min-height: 200px;
  }
  .card h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #2563eb;
    font-size: 1.3rem;
  }
  .highlight {
    font-weight: 700;
    color: #2563eb;
    font-size: 1.1rem;
  }
  .step-title {
    font-weight: 700;
    color: #059669;
    font-size: 1.1rem;
    margin: 15px 0 8px 0;
    border-left: 4px solid #059669;
    padding-left: 8px;
  }
  .final-result {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border: 2px solid #f59e0b;
    border-radius: 10px;
    padding: 18px;
    margin-top: 18px;
    font-weight: 700;
    color: #92400e;
    font-size: 1.1rem;
  }
  .meiling-result {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    border: 2px solid #3b82f6;
    border-radius: 10px;
    padding: 18px;
    margin-top: 12px;
    font-weight: 700;
    color: #1e40af;
    font-size: 1.3rem;
  }
  .profit-step {
    background: #f8fafc;
    border-left: 4px solid #e2e8f0;
    padding: 10px 15px;
    margin: 6px 0;
    border-radius: 6px;
    font-size: 1rem;
  }
  .sensitivity-card {
    background: #f0f9ff;
    border: 2px solid #0ea5e9;
    border-radius: 10px;
    padding: 20px;
    margin: 15px 0;
  }
  .comparison-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #e5e7eb;
    font-size: 1rem;
  }
  .comparison-row:last-child {
    border-bottom: none;
  }
  
  /* ä¸­ç­‰æ‰‹æ©Ÿç‰ˆå„ªåŒ– (481px - 600px) */
  @media (max-width: 600px) and (min-width: 481px) {
    .grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px 8px;
    }
    
    label {
      font-size: 0.8rem;
      margin-bottom: 5px;
    }
    
    input[type="number"] {
      padding: 7px 9px;
      font-size: 0.9rem;
    }
    
    .param-title {
      font-size: 1.05rem;
    }
  }

  /* å¹³æ¿ç‰ˆå„ªåŒ– (768px - 1024px) */
  @media (max-width: 1024px) and (min-width: 769px) {
    main {
      max-width: 900px;
      padding: 0 20px;
    }
    .grid {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 18px 20px;
    }
    .result-box {
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    .card {
      min-height: 180px;
      padding: 20px;
    }
    .final-result, .meiling-result {
      font-size: 1.2rem;
      padding: 15px;
    }
  }

  /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– (768pxä»¥ä¸‹) */
  @media (max-width: 768px) {
    header {
      padding: 20px 15px;
    }
    header h1 {
      font-size: 1.8rem;
    }
    header p {
      font-size: 0.9rem;
    }
    
    main {
      padding: 0 10px;
      margin: 20px auto;
    }
    
    section {
      padding: 20px 15px;
      margin-bottom: 20px;
      border-radius: 12px;
    }
    
    .grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 12px 8px;
    }
    
    .result-box {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .card {
      min-height: auto;
      padding: 20px;
      border-radius: 10px;
    }
    
    .card h3 {
      font-size: 1.2rem;
      margin-bottom: 12px;
    }
    
    .param-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    
    label {
      font-size: 0.85rem;
    }
    
    input[type="number"] {
      padding: 8px 10px;
      font-size: 0.9rem;
    }
    
    button {
      padding: 12px 20px;
      font-size: 0.95rem;
    }
    
    div[style*="display: flex"] {
      flex-direction: column;
      gap: 10px !important;
    }
    
    div[style*="display: flex"] button {
      width: 100% !important;
      min-width: unset !important;
    }
    
    .final-result, .meiling-result {
      font-size: 1rem;
      padding: 15px;
      margin-top: 12px;
    }
    
    .profit-step {
      padding: 8px 12px;
      font-size: 0.9rem;
    }
    
    .step-title {
      font-size: 1rem;
      margin: 12px 0 6px 0;
    }
    
    .sensitivity-card {
      padding: 15px;
    }
    
    .comparison-row {
      font-size: 0.9rem;
      padding: 8px 0;
    }
  }

  /* å°æ‰‹æ©Ÿç‰ˆå„ªåŒ– (480pxä»¥ä¸‹) */
  @media (max-width: 480px) {
    header {
      padding: 15px 10px;
    }
    header h1 {
      font-size: 1.6rem;
    }
    header p {
      font-size: 0.8rem;
    }
    
    main {
      padding: 0 8px;
      margin: 15px auto;
    }
    
    section {
      padding: 15px 12px;
      margin-bottom: 15px;
    }
    
    .grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 8px 6px;
    }
    
    .card {
      padding: 15px;
    }
    
    .card h3 {
      font-size: 1.1rem;
    }
    
    .param-title {
      font-size: 1rem;
    }
    
    label {
      font-size: 0.75rem;
      margin-bottom: 4px;
    }
    
    input[type="number"] {
      padding: 6px 8px;
      font-size: 0.85rem;
    }
    
    button {
      padding: 10px 15px;
      font-size: 0.9rem;
    }
    
    div[style*="display: flex"] {
      flex-direction: column;
      gap: 8px !important;
    }
    
    div[style*="display: flex"] button {
      width: 100% !important;
      min-width: unset !important;
    }
    
    .final-result, .meiling-result {
      font-size: 0.95rem;
      padding: 12px;
    }
    
    .profit-step {
      padding: 6px 10px;
      font-size: 0.85rem;
    }
    
    .step-title {
      font-size: 0.95rem;
    }
    
    .sensitivity-card {
      padding: 12px;
    }
    
    .comparison-row {
      font-size: 0.85rem;
    }
    
    footer {
      padding: 15px 10px !important;
    }
    
    footer p {
      font-size: 0.8rem !important;
    }
  }

  /* å¤§è¢å¹•å„ªåŒ– (1200pxä»¥ä¸Š) */
  @media (min-width: 1200px) {
    main {
      max-width: 1400px;
    }
    
    .grid {
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 22px 28px;
    }
    
    .result-box {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    
    .card {
      min-height: 220px;
      padding: 30px;
    }
    
    .final-result, .meiling-result {
      font-size: 1.4rem;
      padding: 20px;
    }
    
    .param-title {
      font-size: 1.3rem;
    }
    
    input[type="number"] {
      padding: 14px 16px;
      font-size: 1.1rem;
    }
    
    button {
      padding: 16px 32px;
      font-size: 1.1rem;
    }
  }

  /* è¶…å¯¬è¢å¹•å„ªåŒ– (1600pxä»¥ä¸Š) */
  @media (min-width: 1600px) {
    main {
      max-width: 1600px;
    }
    
    .grid {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px 30px;
    }
    
    .result-box {
      grid-template-columns: repeat(4, 1fr);
      gap: 35px;
    }
    
    .card {
      min-height: 250px;
      padding: 35px;
    }
    
    .final-result, .meiling-result {
      font-size: 1.5rem;
      padding: 22px;
    }
  }
</style>
</head>
<body>

<header>
  <h1>ç¾æ¥­å…±äº«å·¥ä½œå®¤è©¦ç®—å·¥å…·</h1>
  <p>2025 å¹´ç‰ˆï½œåˆ†å€é¡¯ç¤ºæ”¶å…¥èˆ‡æ”¯å‡ºï¼Œè®“æŠ•è³‡æ›´é€æ˜</p>
</header>

<main>
  <!-- è¼¸å…¥å€ -->
  <section>
    <h2>è¼¸å…¥è©¦ç®—åƒæ•¸</h2>

    <div class="param-group">
      <div class="param-title">ğŸ‘©â€ğŸ”§ æŠ€å¸«èˆ‡ä¾†é›»å®¢</div>
      <div class="grid">
        <div><label>æŠ€å¸«äººæ•¸</label><input type="number" id="technicians" value="5" min="1" max="8"></div>
        <div><label>å¹³å‡ä¾†é›»å®¢ / æŠ€å¸« / æœˆ</label><input type="number" id="clientsPerTech" value="40"></div>
        <div><label>å®¢å–®åƒ¹ï¼ˆå…ƒï¼‰</label><input type="number" id="pricePerClient" value="2000"></div>
      </div>
    </div>

    <div class="param-group">
      <div class="param-title">ğŸ“š èª²ç¨‹ç›¸é—œ</div>
      <div class="grid">
        <div><label>å…¬æµé‡èª²ç¨‹å ´æ¬¡ / æœˆ</label><input type="number" id="publicCourses" value="2"></div>
        <div><label>å…¬æµé‡èª²ç¨‹å­¸ç”Ÿ / å ´</label><input type="number" id="studentsPerPublic" value="10"></div>
        <div><label>æ··åˆèª²ç¨‹å ´æ¬¡ / æœˆ</label><input type="number" id="mixedCourses" value="1"></div>
        <div><label>æ··åˆèª²ç¨‹å…¬å¸å°å…¥å­¸ç”Ÿ / å ´</label><input type="number" id="companyStudents" value="6"></div>
        <div><label>èª²ç¨‹å­¸è²» / äººï¼ˆå…ƒï¼‰</label><input type="number" id="courseFee" value="10000"></div>
        <div><label>ç§æµé‡è¬›å¸«ç§Ÿç”¨å¤©æ•¸ / æœˆ</label><input type="number" id="privateDays" value="10"></div>
        <div><label>æ•™å®¤æ—¥ç§Ÿåƒ¹ï¼ˆå…ƒ/å¤©ï¼‰</label><input type="number" id="classroomRent" value="1000"></div>
      </div>
    </div>

    <div class="param-group">
      <div class="param-title">ğŸ¢ åˆ†ç§Ÿç©ºé–“</div>
      <div class="grid">
        <div><label>ç¾ç”²æ¡Œæ•¸é‡</label><input type="number" id="nailDesks" value="3"></div>
        <div><label>ç¾ç”²æ¡Œæœˆç§Ÿï¼ˆå…ƒï¼‰</label><input type="number" id="nailDeskRent" value="5000"></div>
        <div><label>ç¾å®¹åºŠæ•¸é‡</label><input type="number" id="beds" value="3"></div>
        <div><label>ç¾å®¹åºŠæœˆç§Ÿï¼ˆå…ƒï¼‰</label><input type="number" id="bedRent" value="5000"></div>
        <div><label>å¤§åŒ…ç®±æ•¸é‡</label><input type="number" id="boxes" value="2"></div>
        <div><label>å¤§åŒ…ç®±æœˆç§Ÿï¼ˆå…ƒï¼‰</label><input type="number" id="boxRent" value="12000"></div>
        <div><label>è»Šä½æ•¸é‡</label><input type="number" id="parkingSpots" value="1"></div>
        <div><label>è»Šä½æœˆç§Ÿï¼ˆå…ƒï¼‰</label><input type="number" id="parkingRent" value="2500"></div>
      </div>
    </div>

    <div class="param-group">
      <div class="param-title">ğŸ’µ æ”¯å‡ºèˆ‡æˆæœ¬</div>
      <div class="grid">
        <div><label>æˆ¿ç§Ÿï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="rent" value="35000"></div>
        <div><label>è»Šä½è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="parkingFee" value="3000"></div>
        <div><label>æ°´è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="waterBill" value="2000"></div>
        <div><label>é›»è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="electricBill" value="8000"></div>
        <div><label>ç¶²è·¯è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="internetBill" value="1500"></div>
        <div><label>æœƒè¨ˆè²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="accountingFee" value="3000"></div>
        <div><label>æ¸…æ½”è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="cleaningFee" value="5000"></div>
        <div><label>ä¿éšªè²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="insurance" value="2000"></div>
        <div><label>è¨­å‚™ç¶­è­·è²»ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="maintenance" value="3000"></div>
        <div><label>å»£å‘Šè€—æï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="marketingExpense" value="5000"></div>
        <div><label>å…¶ä»–é›œæ”¯ï¼ˆå…ƒ/æœˆï¼‰</label><input type="number" id="miscExpense" value="5000"></div>
      </div>
    </div>

    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
      <button onclick="calculate()" style="flex: 1; min-width: 120px;">è¨ˆç®—çµæœ</button>
      <button onclick="resetAll()" style="flex: 1; min-width: 120px; background: #6b7280;">é‡ç½®æ‰€æœ‰æ•¸å€¼</button>
    </div>
  </section>

  <!-- çµæœå€ -->
  <section>
    <h2>è©¦ç®—çµæœ</h2>
    <div class="result-box">
      <div class="card" id="incomeBox">
        <h3>ğŸ“ˆ æ”¶å…¥</h3>
        <p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>
      </div>
      <div class="card" id="expenseBox">
        <h3>ğŸ“‰ æ”¯å‡º</h3>
        <p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>
      </div>
      <div class="card" id="profitBox">
        <h3>ğŸ’° ç›ˆé¤˜èˆ‡åˆ†æ½¤</h3>
        <p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>
      </div>
    </div>
  </section>

  <!-- æ•æ„Ÿåº¦åˆ†æ -->
  <section>
    <h2>ğŸ” æ•æ„Ÿåº¦åˆ†æ</h2>
    <div class="param-group">
      <div class="param-title">é—œéµåƒæ•¸èª¿æ•´æ¸¬è©¦</div>
      <div class="grid">
        <div><label>æŠ€å¸«äººæ•¸èª¿æ•´</label><input type="number" id="techAdjust" value="5" min="1" max="8"></div>
        <div><label>å®¢å–®åƒ¹èª¿æ•´ï¼ˆå…ƒï¼‰</label><input type="number" id="priceAdjust" value="2000" min="1000" max="5000"></div>
        <div><label>èª²ç¨‹å ´æ¬¡èª¿æ•´</label><input type="number" id="courseAdjust" value="2" min="0" max="10"></div>
      </div>
    </div>
    <button onclick="sensitivityAnalysis()">æ•æ„Ÿåº¦åˆ†æ</button>
    <div id="sensitivityResults" style="margin-top: 20px;"></div>
  </section>

  <!-- å ±è¡¨ä¸‹è¼‰ -->
  <section>
    <h2>ğŸ“„ å ±è¡¨ä¸‹è¼‰</h2>
    <div class="param-group">
      <div class="param-title">ç”Ÿæˆå®Œæ•´å ±è¡¨</div>
      <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¸‹è¼‰å®Œæ•´çš„è©¦ç®—å ±è¡¨ï¼ŒåŒ…å«æ‰€æœ‰æ”¶å…¥ã€æ”¯å‡ºã€åˆ†æ½¤åˆ†æåŠå¹´åº¦é æ¸¬ã€‚</p>
      <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
        <button onclick="exportToPDF()" style="background: #dc2626; flex: 1; min-width: 140px;">
          ğŸ“„ ä¸‹è¼‰ PDF å ±è¡¨
        </button>
        <button onclick="exportToExcel()" style="background: #059669; flex: 1; min-width: 140px;">
          ğŸ“Š ä¸‹è¼‰ Excel å ±è¡¨
        </button>
      </div>
    </div>
  </section>
</main>

<!-- ç‰ˆæ¬Šè²æ˜ -->
<footer style="background: #1f2937; color: #fff; text-align: center; padding: 20px; margin-top: 40px; border-top: 3px solid #2563eb;">
  <div style="max-width: 1200px; margin: 0 auto;">
    <p style="margin: 0; font-size: 0.9rem; line-height: 1.6;">
      <strong>âš ï¸ ç‰ˆæ¬Šè²æ˜</strong><br>
      æœ¬è©¦ç®—å·¥å…·ç‚ºè”¡æ¿¬ç‘’å€‹äººé–‹ç™¼ï¼Œå—è‘—ä½œæ¬Šæ³•ä¿è­·ã€‚<br>
      æœªç¶“æˆæ¬Šç¦æ­¢è¤‡è£½ã€è½‰è¼‰ã€å•†ç”¨æˆ–ä»»ä½•å½¢å¼çš„äºŒæ¬¡é–‹ç™¼ã€‚<br>
      å¦‚æœ‰ä½¿ç”¨éœ€æ±‚ï¼Œè«‹è¯ç¹«é–‹ç™¼è€…å–å¾—æˆæ¬Šã€‚<br>
      <span style="color: #fbbf24; font-weight: bold;">è”¡æ¿¬ç‘’è£½ v1.0</span>
    </p>
  </div>
</footer>

<!-- å¼•å…¥å¿…è¦çš„åº« -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
function t(id){ return parseFloat(document.getElementById(id).value)||0; }

function resetAll() {
  // é‡ç½®æ‰€æœ‰è¼¸å…¥å€¼åˆ°é è¨­å€¼
  document.getElementById('technicians').value = 5;
  document.getElementById('clientsPerTech').value = 40;
  document.getElementById('pricePerClient').value = 2000;
  document.getElementById('publicCourses').value = 2;
  document.getElementById('studentsPerPublic').value = 10;
  document.getElementById('mixedCourses').value = 1;
  document.getElementById('companyStudents').value = 6;
  document.getElementById('courseFee').value = 10000;
  document.getElementById('privateDays').value = 10;
  document.getElementById('classroomRent').value = 1000;
  document.getElementById('nailDesks').value = 3;
  document.getElementById('nailDeskRent').value = 5000;
  document.getElementById('beds').value = 3;
  document.getElementById('bedRent').value = 5000;
  document.getElementById('boxes').value = 2;
  document.getElementById('boxRent').value = 12000;
  document.getElementById('parkingSpots').value = 1;
  document.getElementById('parkingRent').value = 2500;
  document.getElementById('rent').value = 35000;
  document.getElementById('parkingFee').value = 3000;
  document.getElementById('waterBill').value = 2000;
  document.getElementById('electricBill').value = 8000;
  document.getElementById('internetBill').value = 1500;
  document.getElementById('accountingFee').value = 3000;
  document.getElementById('cleaningFee').value = 5000;
  document.getElementById('insurance').value = 2000;
  document.getElementById('maintenance').value = 3000;
  document.getElementById('marketingExpense').value = 5000;
  document.getElementById('miscExpense').value = 5000;
  
  // é‡ç½®æ•æ„Ÿåº¦åˆ†æ
  document.getElementById('techAdjust').value = 5;
  document.getElementById('priceAdjust').value = 2000;
  document.getElementById('courseAdjust').value = 2;
  
  // æ¸…ç©ºçµæœ
  document.getElementById('incomeBox').innerHTML = '<h3>ğŸ“ˆ æ”¶å…¥</h3><p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>';
  document.getElementById('expenseBox').innerHTML = '<h3>ğŸ“‰ æ”¯å‡º</h3><p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>';
  document.getElementById('profitBox').innerHTML = '<h3>ğŸ’° ç›ˆé¤˜èˆ‡åˆ†æ½¤</h3><p>è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œè¨ˆç®—çµæœã€</p>';
  document.getElementById('sensitivityResults').innerHTML = '';
  
  // æ¸…ç©ºå…¨åŸŸè®Šæ•¸
  currentResults = {};
  
  alert('æ‰€æœ‰æ•¸å€¼å·²é‡ç½®ç‚ºé è¨­å€¼ï¼');
}

// å…¨åŸŸè®Šæ•¸å„²å­˜è¨ˆç®—çµæœ
let currentResults = {};

function exportToPDF() {
  // ç¢ºä¿å·²ç¶“è¨ˆç®—éçµæœ
  if (!currentResults.totalRevenue) {
    alert('è«‹å…ˆé»æ“Šã€Œè¨ˆç®—çµæœã€ç”Ÿæˆæ•¸æ“šï¼');
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // è¨­å®šæ”¯æ´ä¸­æ–‡çš„å­—é«”
  doc.setFont('helvetica');
  
  // æ·»åŠ ä¸­æ–‡å­—é«”æ”¯æ´
  try {
    // å˜—è©¦ä½¿ç”¨ç³»çµ±å­—é«”
    doc.setFont('helvetica', 'normal');
  } catch (e) {
    console.log('å­—é«”è¨­å®šéŒ¯èª¤ï¼Œä½¿ç”¨é è¨­å­—é«”');
  }
  
  // æ¨™é¡Œ
  doc.setFontSize(20);
  doc.text('Beauty Studio Financial Report', 20, 20);
  
  doc.setFontSize(12);
  doc.text('Generated: ' + new Date().toLocaleDateString('en-US'), 20, 35);
  doc.text('Period: 2025', 20, 45);
  
  let yPosition = 60;
  
  // è¼¸å…¥åƒæ•¸
  doc.setFontSize(16);
  doc.text('Input Parameters', 20, yPosition);
  yPosition += 10;
  
  doc.setFontSize(10);
  doc.text(`Technicians: ${t('technicians')}`, 20, yPosition);
  doc.text(`Price per Client: $${t('pricePerClient')}`, 100, yPosition);
  yPosition += 8;
  
  doc.text(`Courses per Month: ${t('publicCourses')}`, 20, yPosition);
  doc.text(`Nail Desks: ${t('nailDesks')}`, 100, yPosition);
  yPosition += 8;
  
  doc.text(`Beauty Beds: ${t('beds')}`, 20, yPosition);
  doc.text(`Large Rooms: ${t('boxes')}`, 100, yPosition);
  yPosition += 15;
  
  // æ”¶å…¥åˆ†æ
  doc.setFontSize(16);
  doc.text('Revenue Analysis', 20, yPosition);
  yPosition += 10;
  
  doc.setFontSize(10);
  doc.text(`Rental Income: $${currentResults.rentalIncome.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Client Revenue (3/7): $${currentResults.clientRevenue.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Course Income (3/7): $${(currentResults.publicCourseRevenue + currentResults.mixedCourseRevenue).toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Classroom Rent: $${currentResults.privateClassRent.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  
  doc.setFontSize(12);
  doc.text(`Total Revenue: $${currentResults.totalRevenue.toLocaleString()}`, 20, yPosition);
  yPosition += 15;
  
  // æ”¯å‡ºåˆ†æ
  doc.setFontSize(16);
  doc.text('Expense Analysis', 20, yPosition);
  yPosition += 10;
  
  doc.setFontSize(10);
  doc.text(`Rent: $${t('rent').toLocaleString()}`, 20, yPosition);
  doc.text(`Parking: $${t('parkingFee').toLocaleString()}`, 100, yPosition);
  yPosition += 8;
  doc.text(`Utilities: $${(t('waterBill') + t('electricBill')).toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Accounting: $${t('accountingFee').toLocaleString()}`, 20, yPosition);
  doc.text(`Cleaning: $${t('cleaningFee').toLocaleString()}`, 100, yPosition);
  yPosition += 8;
  doc.text(`Marketing Materials: $${t('marketingExpense').toLocaleString()}`, 20, yPosition);
  doc.text(`Miscellaneous: $${t('miscExpense').toLocaleString()}`, 100, yPosition);
  yPosition += 8;
  
  doc.setFontSize(12);
  doc.text(`Total Expenses: $${currentResults.totalCost.toLocaleString()}`, 20, yPosition);
  yPosition += 15;
  
  // åˆ†æ½¤åˆ†æ
  doc.setFontSize(16);
  doc.text('Profit Distribution', 20, yPosition);
  yPosition += 10;
  
  doc.setFontSize(10);
  doc.text(`Net Profit: $${currentResults.netProfit.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Marketing Bonus (20%): $${currentResults.marketingBonus.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Meiling Share (95%): $${currentResults.share95.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Team Share (5%): $${currentResults.share5.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  
  doc.setFontSize(12);
  doc.text(`Team Total Income: $${currentResults.youTotal.toLocaleString()}`, 20, yPosition);
  yPosition += 8;
  doc.text(`Meiling Total Income: $${currentResults.share95.toLocaleString()}`, 20, yPosition);
  yPosition += 15;
  
  
  // ä¸‹è¼‰PDF
  doc.save('Beauty_Studio_Financial_Report.pdf');
}

function exportToExcel() {
  // ç¢ºä¿å·²ç¶“è¨ˆç®—éçµæœ
  if (!currentResults.totalRevenue) {
    alert('è«‹å…ˆé»æ“Šã€Œè¨ˆç®—çµæœã€ç”Ÿæˆæ•¸æ“šï¼');
    return;
  }

  // å‰µå»ºå·¥ä½œç°¿
  const wb = XLSX.utils.book_new();
  
  // å‰µå»ºä¸»è¦å ±è¡¨å·¥ä½œè¡¨
  const reportData = [
    // æ¨™é¡Œå€
    ['ç¾æ¥­å…±äº«å·¥ä½œå®¤è²¡å‹™å ±è¡¨ 2025', '', '', '', '', '', ''],
    ['', '', '', '', '', '', ''],
    ['å ±å‘ŠæœŸé–“', '2025å¹´', '', '', 'ç”Ÿæˆæ—¥æœŸ', new Date().toLocaleDateString('zh-TW'), ''],
    ['', '', '', '', '', '', ''],
    
    // è¼¸å…¥åƒæ•¸å€
    ['ğŸ“‹ ç‡Ÿé‹åƒæ•¸è¨­å®š', '', '', '', '', '', ''],
    ['é …ç›®', 'æ•¸å€¼', 'å–®ä½', 'èªªæ˜', '', '', ''],
    ['æŠ€å¸«äººæ•¸', t('technicians'), 'äºº', 'å·¥ä½œå®¤æŠ€å¸«ç¸½æ•¸', '', '', ''],
    ['å¹³å‡ä¾†é›»å®¢/æŠ€å¸«/æœˆ', t('clientsPerTech'), 'äºº', 'æ¯ä½æŠ€å¸«æ¯æœˆæœå‹™å®¢æˆ¶æ•¸', '', '', ''],
    ['å®¢å–®åƒ¹', t('pricePerClient'), 'å…ƒ', 'æ¯ä½å®¢æˆ¶å¹³å‡æ¶ˆè²»é‡‘é¡', '', '', ''],
    ['å…¬æµé‡èª²ç¨‹å ´æ¬¡/æœˆ', t('publicCourses'), 'å ´', 'æ¯æœˆå…¬é–‹èª²ç¨‹èˆ‰è¾¦å ´æ¬¡', '', '', ''],
    ['å…¬æµé‡èª²ç¨‹å­¸ç”Ÿ/å ´', t('studentsPerPublic'), 'äºº', 'æ¯å ´å…¬é–‹èª²ç¨‹å­¸å“¡äººæ•¸', '', '', ''],
    ['æ··åˆèª²ç¨‹å ´æ¬¡/æœˆ', t('mixedCourses'), 'å ´', 'æ¯æœˆæ··åˆèª²ç¨‹èˆ‰è¾¦å ´æ¬¡', '', '', ''],
    ['æ··åˆèª²ç¨‹å…¬å¸å°å…¥å­¸ç”Ÿ/å ´', t('companyStudents'), 'äºº', 'æ¯å ´æ··åˆèª²ç¨‹å…¬å¸å­¸å“¡æ•¸', '', '', ''],
    ['èª²ç¨‹å­¸è²»/äºº', t('courseFee'), 'å…ƒ', 'æ¯äººèª²ç¨‹æ”¶è²»æ¨™æº–', '', '', ''],
    ['ç§æµé‡è¬›å¸«ç§Ÿç”¨å¤©æ•¸/æœˆ', t('privateDays'), 'å¤©', 'æ¯æœˆç§äººè¬›å¸«ç§Ÿç”¨å¤©æ•¸', '', '', ''],
    ['æ•™å®¤æ—¥ç§Ÿåƒ¹', t('classroomRent'), 'å…ƒ', 'æ•™å®¤æ¯æ—¥ç§Ÿé‡‘', '', '', ''],
    ['', '', '', '', '', '', ''],
    
    // ç©ºé–“é…ç½®å€ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ¢ ç©ºé–“é…ç½®èˆ‡ç§Ÿé‡‘', '', '', '', '', '', ''],
    ['é …ç›®', 'æ•¸é‡', 'æœˆç§Ÿå–®åƒ¹', 'æœˆç§Ÿç¸½é¡', 'å¹´ç§Ÿç¸½é¡', 'åˆ©ç”¨ç‡', 'å‚™è¨»'],
    ['ç¾ç”²æ¡Œ', t('nailDesks'), t('nailDeskRent'), `=B20*C20`, `=D20*12`, '100%', 'å›ºå®šç§Ÿç”¨'],
    ['ç¾å®¹åºŠ', t('beds'), t('bedRent'), `=B21*C21`, `=D21*12`, '100%', 'å›ºå®šç§Ÿç”¨'],
    ['å¤§åŒ…ç®±', t('boxes'), t('boxRent'), `=B22*C22`, `=D22*12`, '100%', 'å›ºå®šç§Ÿç”¨'],
    ['è»Šä½', t('parkingSpots'), t('parkingRent'), `=B23*C23`, `=D23*12`, '100%', 'å›ºå®šç§Ÿç”¨'],
    ['ç©ºé–“ç§Ÿé‡‘å°è¨ˆ', '', '', `=SUM(D20:D23)`, `=SUM(E20:E23)`, '', ''],
    ['', '', '', '', '', '', ''],
    
    // æ”¶å…¥åˆ†æå€ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ“ˆ æ”¶å…¥çµæ§‹åˆ†æ', '', '', '', '', '', ''],
    ['æ”¶å…¥é …ç›®', 'è¨ˆç®—å…¬å¼', 'æœˆæ”¶å…¥', 'å¹´æ”¶å…¥', 'ä½”æ¯”', 'æˆé•·æ½›åŠ›', 'å‚™è¨»'],
    ['å…¬å¸åˆ†ç§Ÿæ”¶å…¥', 'ç©ºé–“ç§Ÿé‡‘ç¸½è¨ˆ', currentResults.rentalIncome, `=C28*12`, `=C28/$C$32`, 'ç©©å®š', 'å›ºå®šç§Ÿé‡‘æ”¶å…¥'],
    ['ä¾†é›»å®¢å…¬å¸åˆ†æ½¤', 'æŠ€å¸«æ•¸Ã—å®¢æ•¸Ã—å®¢å–®åƒ¹Ã—3/7', currentResults.clientRevenue, `=C29*12`, `=C29/$C$32`, 'é«˜', 'ä¸»è¦æˆé•·å‹•èƒ½'],
    ['èª²ç¨‹æ”¶å…¥(3/7æŠ½æˆ)', 'èª²ç¨‹å ´æ¬¡Ã—å­¸å“¡Ã—å­¸è²»Ã—3/7', currentResults.publicCourseRevenue + currentResults.mixedCourseRevenue, `=C30*12`, `=C30/$C$32`, 'ä¸­', 'å­£ç¯€æ€§æ³¢å‹•'],
    ['æ•™å®¤ç§Ÿé‡‘(ç§æµé‡)', 'ç§Ÿç”¨å¤©æ•¸Ã—æ—¥ç§Ÿåƒ¹', currentResults.privateClassRent, `=C31*12`, `=C31/$C$32`, 'ä½', 'è£œå……æ”¶å…¥'],
    ['ç¸½ç‡Ÿæ”¶', 'æ”¶å…¥é …ç›®åŠ ç¸½', currentResults.totalRevenue, `=C32*12`, '100%', '', ''],
    ['', '', '', '', '', '', ''],
    
    // æ”¯å‡ºåˆ†æå€ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ“‰ æ”¯å‡ºçµæ§‹åˆ†æ', '', '', '', '', '', ''],
    ['æ”¯å‡ºé …ç›®', 'æœˆæ”¯å‡º', 'å¹´æ”¯å‡º', 'ä½”ç¸½æ”¯å‡ºæ¯”', 'å¯æ§åˆ¶æ€§', 'å„ªåŒ–å»ºè­°', 'å‚™è¨»'],
    ['æˆ¿ç§Ÿ', t('rent'), `=B36*12`, `=B36/$B$47`, 'å›ºå®š', 'é•·æœŸåˆç´„', 'æœ€å¤§æ”¯å‡ºé …ç›®'],
    ['è»Šä½è²»', t('parkingFee'), `=B37*12`, `=B37/$B$47`, 'å›ºå®š', 'é•·æœŸåˆç´„', 'å¿…è¦æ”¯å‡º'],
    ['æ°´è²»', t('waterBill'), `=B38*12`, `=B38/$B$47`, 'è®Šå‹•', 'ç¯€æ°´æªæ–½', 'å­£ç¯€æ€§æ³¢å‹•'],
    ['é›»è²»', t('electricBill'), `=B39*12`, `=B39/$B$47`, 'è®Šå‹•', 'ç¯€èƒ½è¨­å‚™', 'å¤å­£é«˜å³°'],
    ['ç¶²è·¯è²»', t('internetBill'), `=B40*12`, `=B40/$B$47`, 'å›ºå®š', 'åˆç´„å„ªåŒ–', 'å¿…è¦æ”¯å‡º'],
    ['æœƒè¨ˆè²»', t('accountingFee'), `=B41*12`, `=B41/$B$47`, 'å›ºå®š', 'æœå‹™æ¯”è¼ƒ', 'å°ˆæ¥­æœå‹™'],
    ['æ¸…æ½”è²»', t('cleaningFee'), `=B42*12`, `=B42/$B$47`, 'è®Šå‹•', 'é »ç‡èª¿æ•´', 'å¯å„ªåŒ–'],
    ['ä¿éšªè²»', t('insurance'), `=B43*12`, `=B43/$B$47`, 'å›ºå®š', 'æ–¹æ¡ˆæ¯”è¼ƒ', 'é¢¨éšªç®¡æ§'],
    ['è¨­å‚™ç¶­è­·è²»', t('maintenance'), `=B44*12`, `=B44/$B$47`, 'è®Šå‹•', 'é é˜²ä¿é¤Š', 'è¨­å‚™ç®¡ç†'],
    ['å»£å‘Šè€—æ', t('marketingExpense'), `=B45*12`, `=B45/$B$47`, 'è®Šå‹•', 'æ•ˆæœè©•ä¼°', 'è¡ŒéŠ·æŠ•è³‡'],
    ['å…¶ä»–é›œæ”¯', t('miscExpense'), `=B46*12`, `=B46/$B$47`, 'è®Šå‹•', 'é ç®—æ§åˆ¶', 'å½ˆæ€§æ”¯å‡º'],
    ['ç¸½æ”¯å‡º', currentResults.totalCost, `=B47*12`, '100%', '', '', ''],
    ['', '', '', '', '', '', ''],
    
    // åˆ†æ½¤åˆ†æå€ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ’° åˆ†æ½¤æ©Ÿåˆ¶åˆ†æ', '', '', '', '', '', ''],
    ['åˆ†æ½¤é …ç›®', 'è¨ˆç®—åŸºç¤', 'æœˆé‡‘é¡', 'å¹´é‡‘é¡', 'åˆ†é…æ¯”ä¾‹', 'è² è²¬äºº', 'å‚™è¨»'],
    ['ç¨…å¾Œæ·¨åˆ©', 'ç¸½ç‡Ÿæ”¶-ç¸½æ”¯å‡º', currentResults.netProfit, `=C51*12`, '100%', 'å…¬å¸', 'åˆ†æ½¤åŸºç¤'],
    ['è¡ŒéŠ·åˆ†æ½¤', 'æ·¨åˆ©Ã—20%', currentResults.marketingBonus, `=C52*12`, '20%', 'æ¿¬ç‘’+å­è²', 'è¡ŒéŠ·çå‹µ'],
    ['å‰©é¤˜åˆ©æ½¤', 'æ·¨åˆ©-è¡ŒéŠ·åˆ†æ½¤', currentResults.remainingProfit, `=C53*12`, '80%', 'å…¬å¸', 'è‚¡æ¬Šåˆ†æ½¤åŸºç¤'],
    ['æ¢…éˆ´è‚¡æ¬Šåˆ†ç´…', 'å‰©é¤˜åˆ©æ½¤Ã—95%', currentResults.share95, `=C54*12`, '76%', 'æ¢…éˆ´', 'å¤§è‚¡æ±åˆ†æ½¤'],
    ['åœ˜éšŠè‚¡æ¬Šåˆ†ç´…', 'å‰©é¤˜åˆ©æ½¤Ã—5%', currentResults.share5, `=C55*12`, '4%', 'æ¿¬ç‘’+å­è²', 'å°è‚¡æ±åˆ†æ½¤'],
    ['', '', '', '', '', '', ''],
    
    // ç¸½æ”¶ç›Šæ‘˜è¦ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ¯ å€‹äººæ”¶ç›Šæ‘˜è¦', '', '', '', '', '', ''],
    ['å—ç›Šäºº', 'è‚¡æ¬Šåˆ†ç´…', 'è¡ŒéŠ·åˆ†æ½¤', 'ç¸½æ”¶ç›Š', 'å¹´æ”¶ç›Š', 'ä½”æ¯”', ''],
    ['æ¿¬ç‘’+å­è²', currentResults.share5, currentResults.marketingBonus, currentResults.youTotal, `=D59*12`, `=D59/(D59+D60)`, ''],
    ['æ¢…éˆ´', currentResults.share95, 0, currentResults.share95, `=D60*12`, `=D60/(D59+D60)`, ''],
    ['', '', '', '', '', '', ''],
    
    // è²¡å‹™æŒ‡æ¨™ (ä¿®æ­£å…¬å¼åƒç…§)
    ['ğŸ“Š è²¡å‹™å¥åº·æŒ‡æ¨™', '', '', '', '', '', ''],
    ['æŒ‡æ¨™é …ç›®', 'æ•¸å€¼', 'å–®ä½', 'æ¨™æº–å€¼', 'è©•ä¼°', 'èªªæ˜', ''],
    ['æ¯›åˆ©ç‡', `=(C32-B47)/C32*100`, '%', '>30%', currentResults.netProfit/currentResults.totalRevenue*100 > 0.3 ? 'è‰¯å¥½' : 'å¾…æ”¹å–„', 'ç²åˆ©èƒ½åŠ›æŒ‡æ¨™', ''],
    ['æ·¨åˆ©ç‡', `=C51/C32*100`, '%', '>20%', currentResults.netProfit/currentResults.totalRevenue*100 > 0.2 ? 'å„ªç§€' : 'ä¸€èˆ¬', 'ç‡Ÿé‹æ•ˆç‡æŒ‡æ¨™', ''],
    ['æ”¯å‡ºä½”æ¯”', `=B47/C32*100`, '%', '<80%', currentResults.totalCost/currentResults.totalRevenue*100 < 0.8 ? 'è‰¯å¥½' : 'åé«˜', 'æˆæœ¬æ§åˆ¶æŒ‡æ¨™', ''],
    ['æŠ•è³‡å›å ±ç‡', `=D59/B36*100`, '%', '>100%', currentResults.youTotal/t('rent')*100 > 100 ? 'å„ªç§€' : 'ä¸€èˆ¬', 'æŠ•è³‡æ•ˆç›ŠæŒ‡æ¨™', ''],
    ['', '', '', '', '', '', ''],
    
    // ç‰ˆæ¬Šè²æ˜
    ['', '', '', '', '', '', ''],
    ['ç‰ˆæ¬Šè²æ˜', '', '', '', '', '', ''],
    ['æœ¬å ±è¡¨ç”±è”¡æ¿¬ç‘’é–‹ç™¼è£½ä½œ v1.0', '', '', '', '', '', ''],
    ['æœªç¶“æˆæ¬Šç¦æ­¢è¤‡è£½æˆ–å•†ç”¨', '', '', '', '', '', '']
  ];
  
  // å‰µå»ºä¸»è¦å ±è¡¨å·¥ä½œè¡¨
  const ws = XLSX.utils.aoa_to_sheet(reportData);
  
  // è¨­å®šåˆ—å¯¬
  ws['!cols'] = [
    {wch: 20}, // Aåˆ—
    {wch: 15}, // Båˆ—
    {wch: 12}, // Cåˆ—
    {wch: 15}, // Dåˆ—
    {wch: 15}, // Eåˆ—
    {wch: 12}, // Fåˆ—
    {wch: 20}  // Gåˆ—
  ];
  
  // è¨­å®šè¡Œé«˜
  ws['!rows'] = Array(60).fill().map(() => ({hpt: 18}));
  
  // åˆä½µæ¨™é¡Œå–®å…ƒæ ¼
  ws['!merges'] = [
    {s: {r: 0, c: 0}, e: {r: 0, c: 6}}, // ä¸»æ¨™é¡Œ
    {s: {r: 1, c: 0}, e: {r: 1, c: 6}}  // ç©ºè¡Œ
  ];
  
  XLSX.utils.book_append_sheet(wb, ws, 'è²¡å‹™å ±è¡¨');
  
  // å‰µå»ºæ•æ„Ÿåº¦åˆ†æå·¥ä½œè¡¨
  const sensitivityData = [
    ['ğŸ” æ•æ„Ÿåº¦åˆ†æ', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['åƒæ•¸èª¿æ•´', 'åŸå§‹å€¼', 'èª¿æ•´å€¼', 'æ”¶å…¥è®ŠåŒ–', 'æ”¶ç›Šè®ŠåŒ–', 'è®ŠåŒ–ç‡'],
    ['æŠ€å¸«äººæ•¸', t('technicians'), t('techAdjust'), '', '', ''],
    ['å®¢å–®åƒ¹', t('pricePerClient'), t('priceAdjust'), '', '', ''],
    ['èª²ç¨‹å ´æ¬¡', t('publicCourses'), t('courseAdjust'), '', '', ''],
    ['', '', '', '', '', ''],
    ['æƒ…å¢ƒåˆ†æ', '', '', '', '', ''],
    ['ä¿å®ˆæƒ…å¢ƒ (æŠ€å¸«-1, å®¢å–®åƒ¹-200)', '', '', '', '', ''],
    ['æ¨‚è§€æƒ…å¢ƒ (æŠ€å¸«+1, å®¢å–®åƒ¹+300)', '', '', '', '', ''],
    ['æ¥µç«¯æƒ…å¢ƒ (æŠ€å¸«+2, å®¢å–®åƒ¹+500)', '', '', '', '', '']
  ];
  
  const ws2 = XLSX.utils.aoa_to_sheet(sensitivityData);
  ws2['!cols'] = [
    {wch: 25}, {wch: 12}, {wch: 12}, {wch: 15}, {wch: 15}, {wch: 12}
  ];
  
  XLSX.utils.book_append_sheet(wb, ws2, 'æ•æ„Ÿåº¦åˆ†æ');
  
  // å‰µå»ºæœˆåº¦é æ¸¬å·¥ä½œè¡¨ (ä¿®æ­£å…¬å¼åƒç…§)
  const monthlyForecastData = [
    ['ğŸ“… æœˆåº¦è²¡å‹™é æ¸¬', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['æœˆä»½', 'ç‡Ÿæ”¶é æ¸¬', 'æ”¯å‡ºé æ¸¬', 'æ·¨åˆ©é æ¸¬', 'æ¿¬ç‘’+å­è²æ”¶ç›Š', 'æ¢…éˆ´æ”¶ç›Š'],
    ['1æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B4-C4`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['2æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B5-C5`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['3æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B6-C6`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['4æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B7-C7`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['5æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B8-C8`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['6æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B9-C9`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['7æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B10-C10`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['8æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B11-C11`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['9æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B12-C12`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['10æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B13-C13`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['11æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B14-C14`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['12æœˆ', `=è²¡å‹™å ±è¡¨!C32`, `=è²¡å‹™å ±è¡¨!B47`, `=B15-C15`, `=è²¡å‹™å ±è¡¨!D59`, `=è²¡å‹™å ±è¡¨!D60`],
    ['å¹´åº¦ç¸½è¨ˆ', `=SUM(B4:B15)`, `=SUM(C4:C15)`, `=SUM(D4:D15)`, `=SUM(E4:E15)`, `=SUM(F4:F15)`],
    ['', '', '', '', '', ''],
    ['ğŸ“Š å­£åº¦åˆ†æ', '', '', '', '', ''],
    ['Q1 (1-3æœˆ)', `=SUM(B4:B6)`, `=SUM(C4:C6)`, `=SUM(D4:D6)`, `=SUM(E4:E6)`, `=SUM(F4:F6)`],
    ['Q2 (4-6æœˆ)', `=SUM(B7:B9)`, `=SUM(C7:C9)`, `=SUM(D7:D9)`, `=SUM(E7:E9)`, `=SUM(F7:F9)`],
    ['Q3 (7-9æœˆ)', `=SUM(B10:B12)`, `=SUM(C10:C12)`, `=SUM(D10:D12)`, `=SUM(E10:E12)`, `=SUM(F10:F12)`],
    ['Q4 (10-12æœˆ)', `=SUM(B13:B15)`, `=SUM(C13:C15)`, `=SUM(D13:D15)`, `=SUM(E13:E15)`, `=SUM(F13:F15)`]
  ];
  
  const ws3 = XLSX.utils.aoa_to_sheet(monthlyForecastData);
  ws3['!cols'] = [
    {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 18}, {wch: 15}
  ];
  
  XLSX.utils.book_append_sheet(wb, ws3, 'æœˆåº¦é æ¸¬');
  
  // å‰µå»ºæˆæœ¬åˆ†æå·¥ä½œè¡¨ (ä¿®æ­£å…¬å¼åƒç…§)
  const costAnalysisData = [
    ['ğŸ’° æˆæœ¬çµæ§‹åˆ†æ', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['æˆæœ¬åˆ†é¡', 'æœˆæ”¯å‡º', 'å¹´æ”¯å‡º', 'ä½”ç¸½æ”¯å‡ºæ¯”', 'å¯å„ªåŒ–ç¨‹åº¦', 'å„ªåŒ–å»ºè­°'],
    ['å›ºå®šæˆæœ¬', `=è²¡å‹™å ±è¡¨!B36+è²¡å‹™å ±è¡¨!B37+è²¡å‹™å ±è¡¨!B40+è²¡å‹™å ±è¡¨!B41+è²¡å‹™å ±è¡¨!B43`, `=B4*12`, `=B4/è²¡å‹™å ±è¡¨!B47*100`, 'ä½', 'é•·æœŸåˆç´„ï¼Œè­°åƒ¹ç©ºé–“æœ‰é™'],
    ['è®Šå‹•æˆæœ¬', `=è²¡å‹™å ±è¡¨!B38+è²¡å‹™å ±è¡¨!B39+è²¡å‹™å ±è¡¨!B42+è²¡å‹™å ±è¡¨!B44+è²¡å‹™å ±è¡¨!B45+è²¡å‹™å ±è¡¨!B46`, `=B5*12`, `=B5/è²¡å‹™å ±è¡¨!B47*100`, 'é«˜', 'å¯é€éç®¡ç†å„ªåŒ–'],
    ['', '', '', '', '', ''],
    ['ğŸ” æˆæœ¬æ˜ç´°åˆ†æ', '', '', '', '', ''],
    ['æ”¯å‡ºé …ç›®', 'æœˆæ”¯å‡º', 'å¹´æ”¯å‡º', 'ä½”æ¯”', 'æ§åˆ¶é›£åº¦', 'å„ªåŒ–ç­–ç•¥'],
    ['æˆ¿ç§Ÿ', t('rent'), `=B8*12`, `=B8/è²¡å‹™å ±è¡¨!B47*100`, 'å›°é›£', 'é•·æœŸåˆç´„'],
    ['è»Šä½è²»', t('parkingFee'), `=B9*12`, `=B9/è²¡å‹™å ±è¡¨!B47*100`, 'å›°é›£', 'å¿…è¦æ”¯å‡º'],
    ['æ°´é›»è²»', `=è²¡å‹™å ±è¡¨!B38+è²¡å‹™å ±è¡¨!B39`, `=B10*12`, `=B10/è²¡å‹™å ±è¡¨!B47*100`, 'ä¸­ç­‰', 'ç¯€èƒ½è¨­å‚™'],
    ['ç¶²è·¯è²»', t('internetBill'), `=B11*12`, `=B11/è²¡å‹™å ±è¡¨!B47*100`, 'å®¹æ˜“', 'åˆç´„æ¯”è¼ƒ'],
    ['æœƒè¨ˆè²»', t('accountingFee'), `=B12*12`, `=B12/è²¡å‹™å ±è¡¨!B47*100`, 'å®¹æ˜“', 'æœå‹™æ¯”è¼ƒ'],
    ['æ¸…æ½”è²»', t('cleaningFee'), `=B13*12`, `=B13/è²¡å‹™å ±è¡¨!B47*100`, 'ä¸­ç­‰', 'é »ç‡èª¿æ•´'],
    ['ä¿éšªè²»', t('insurance'), `=B14*12`, `=B14/è²¡å‹™å ±è¡¨!B47*100`, 'å®¹æ˜“', 'æ–¹æ¡ˆæ¯”è¼ƒ'],
    ['è¨­å‚™ç¶­è­·è²»', t('maintenance'), `=B15*12`, `=B15/è²¡å‹™å ±è¡¨!B47*100`, 'ä¸­ç­‰', 'é é˜²ä¿é¤Š'],
    ['å»£å‘Šè€—æ', t('marketingExpense'), `=B16*12`, `=B16/è²¡å‹™å ±è¡¨!B47*100`, 'å®¹æ˜“', 'æ•ˆæœè©•ä¼°'],
    ['å…¶ä»–é›œæ”¯', t('miscExpense'), `=B17*12`, `=B17/è²¡å‹™å ±è¡¨!B47*100`, 'å®¹æ˜“', 'é ç®—æ§åˆ¶'],
    ['ç¸½æ”¯å‡º', currentResults.totalCost, `=B18*12`, '100%', '', ''],
    ['', '', '', '', '', ''],
    ['ğŸ“ˆ æˆæœ¬æ•ˆç›Šåˆ†æ', '', '', '', '', ''],
    ['æ•ˆç›ŠæŒ‡æ¨™', 'æ•¸å€¼', 'å–®ä½', 'ç›®æ¨™å€¼', 'è©•ä¼°', 'èªªæ˜'],
    ['æˆæœ¬ä½”ç‡Ÿæ”¶æ¯”', `=è²¡å‹™å ±è¡¨!B47/è²¡å‹™å ±è¡¨!C32*100`, '%', '<70%', currentResults.totalCost/currentResults.totalRevenue*100 < 0.7 ? 'å„ªç§€' : 'å¾…æ”¹å–„', 'æˆæœ¬æ§åˆ¶æŒ‡æ¨™'],
    ['å›ºå®šæˆæœ¬æ¯”', `=B4/è²¡å‹™å ±è¡¨!B47*100`, '%', '<60%', (t('rent')+t('parkingFee')+t('internetBill')+t('accountingFee')+t('insurance'))/currentResults.totalCost*100 < 0.6 ? 'è‰¯å¥½' : 'åé«˜', 'å›ºå®šæˆæœ¬æ§åˆ¶'],
    ['è®Šå‹•æˆæœ¬æ¯”', `=B5/è²¡å‹™å ±è¡¨!B47*100`, '%', '<40%', (t('waterBill')+t('electricBill')+t('cleaningFee')+t('maintenance')+t('marketingExpense')+t('miscExpense'))/currentResults.totalCost*100 < 0.4 ? 'è‰¯å¥½' : 'åé«˜', 'è®Šå‹•æˆæœ¬æ§åˆ¶']
  ];
  
  const ws4 = XLSX.utils.aoa_to_sheet(costAnalysisData);
  ws4['!cols'] = [
    {wch: 20}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 25}
  ];
  
  XLSX.utils.book_append_sheet(wb, ws4, 'æˆæœ¬åˆ†æ');
  
  // å‰µå»ºç‡Ÿæ”¶åˆ†æå·¥ä½œè¡¨ (ä¿®æ­£å…¬å¼åƒç…§)
  const revenueAnalysisData = [
    ['ğŸ“Š ç‡Ÿæ”¶çµæ§‹åˆ†æ', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['æ”¶å…¥ä¾†æº', 'æœˆæ”¶å…¥', 'å¹´æ”¶å…¥', 'ä½”æ¯”', 'æˆé•·æ½›åŠ›', 'ç©©å®šæ€§'],
    ['åˆ†ç§Ÿæ”¶å…¥', currentResults.rentalIncome, `=B4*12`, `=B4/è²¡å‹™å ±è¡¨!C32*100`, 'ä½', 'é«˜'],
    ['ä¾†é›»å®¢åˆ†æ½¤', currentResults.clientRevenue, `=B5*12`, `=B5/è²¡å‹™å ±è¡¨!C32*100`, 'é«˜', 'ä¸­'],
    ['èª²ç¨‹æ”¶å…¥', currentResults.publicCourseRevenue + currentResults.mixedCourseRevenue, `=B6*12`, `=B6/è²¡å‹™å ±è¡¨!C32*100`, 'ä¸­', 'ä¸­'],
    ['æ•™å®¤ç§Ÿé‡‘', currentResults.privateClassRent, `=B7*12`, `=B7/è²¡å‹™å ±è¡¨!C32*100`, 'ä½', 'ä¸­'],
    ['ç¸½ç‡Ÿæ”¶', currentResults.totalRevenue, `=B8*12`, '100%', '', ''],
    ['', '', '', '', '', ''],
    ['ğŸ¯ æ”¶å…¥æˆé•·ç­–ç•¥', '', '', '', '', ''],
    ['ç­–ç•¥é …ç›®', 'é æœŸæå‡', 'å¯¦æ–½é›£åº¦', 'æŠ•å…¥æˆæœ¬', 'é æœŸæ”¶ç›Š', 'å„ªå…ˆç´š'],
    ['å¢åŠ æŠ€å¸«äººæ•¸', '+20%ç‡Ÿæ”¶', 'ä¸­ç­‰', 'ä½', 'é«˜', 'é«˜'],
    ['æå‡å®¢å–®åƒ¹', '+15%ç‡Ÿæ”¶', 'å›°é›£', 'ä¸­', 'ä¸­', 'ä¸­'],
    ['å¢åŠ èª²ç¨‹å ´æ¬¡', '+10%ç‡Ÿæ”¶', 'å®¹æ˜“', 'ä½', 'ä¸­', 'ä¸­'],
    ['é–‹ç™¼æ–°æœå‹™', '+25%ç‡Ÿæ”¶', 'å›°é›£', 'é«˜', 'é«˜', 'ä½'],
    ['å„ªåŒ–ç©ºé–“åˆ©ç”¨ç‡', '+5%ç‡Ÿæ”¶', 'å®¹æ˜“', 'ä½', 'ä½', 'é«˜'],
    ['', '', '', '', '', ''],
    ['ğŸ“ˆ æ”¶å…¥è¶¨å‹¢é æ¸¬', '', '', '', '', ''],
    ['æœˆä»½', 'ä¿å®ˆé æ¸¬', 'æ¨‚è§€é æ¸¬', 'å·®ç•°', 'é”æˆç‡', 'å‚™è¨»'],
    ['1æœˆ', currentResults.totalRevenue, Math.floor(currentResults.totalRevenue * 1.1), Math.floor(currentResults.totalRevenue * 0.1), '100%', 'åŸºæº–æœˆ'],
    ['2æœˆ', Math.floor(currentResults.totalRevenue * 0.95), Math.floor(currentResults.totalRevenue * 1.05), Math.floor(currentResults.totalRevenue * 0.1), '95%', 'æ˜¥ç¯€å½±éŸ¿'],
    ['3æœˆ', currentResults.totalRevenue, Math.floor(currentResults.totalRevenue * 1.15), Math.floor(currentResults.totalRevenue * 0.15), '100%', 'å¾©ç”¦æœŸ'],
    ['4æœˆ', Math.floor(currentResults.totalRevenue * 1.05), Math.floor(currentResults.totalRevenue * 1.2), Math.floor(currentResults.totalRevenue * 0.15), '105%', 'æˆé•·æœŸ'],
    ['5æœˆ', Math.floor(currentResults.totalRevenue * 1.1), Math.floor(currentResults.totalRevenue * 1.25), Math.floor(currentResults.totalRevenue * 0.15), '110%', 'æ—ºå­£'],
    ['6æœˆ', Math.floor(currentResults.totalRevenue * 1.15), Math.floor(currentResults.totalRevenue * 1.3), Math.floor(currentResults.totalRevenue * 0.15), '115%', 'é«˜å³°']
  ];
  
  const ws5 = XLSX.utils.aoa_to_sheet(revenueAnalysisData);
  ws5['!cols'] = [
    {wch: 20}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 20}
  ];
  
  XLSX.utils.book_append_sheet(wb, ws5, 'ç‡Ÿæ”¶åˆ†æ');
  
  // å‰µå»ºæŠ•è³‡å›å ±åˆ†æå·¥ä½œè¡¨
  const roiAnalysisData = [
    ['ğŸ’ æŠ•è³‡å›å ±åˆ†æ', '', '', '', '', ''],
    ['', '', '', '', '', ''],
    ['æŠ•è³‡é …ç›®', 'æŠ•è³‡é‡‘é¡', 'æœˆæ”¶ç›Š', 'å¹´æ”¶ç›Š', 'å›å ±ç‡', 'å›æœ¬æœŸé–“'],
    ['æ¿¬ç‘’+å­è²æŠ•è³‡', t('rent'), currentResults.youTotal, `=C4*12`, `=D4/B4*100`, `=B4/C4`],
    ['æ¢…éˆ´æŠ•è³‡', Math.floor(t('rent') * 19), currentResults.share95, `=C5*12`, `=D5/B5*100`, `=B5/C5`],
    ['ç¸½æŠ•è³‡', `=B4+B5`, `=C4+C5`, `=D4+D5`, `=D6/B6*100`, `=B6/C6`],
    ['', '', '', '', '', ''],
    ['ğŸ“Š å›å ±ç‡æ¯”è¼ƒ', '', '', '', '', ''],
    ['æ¯”è¼ƒé …ç›®', 'æ•¸å€¼', 'å–®ä½', 'è¡Œæ¥­æ¨™æº–', 'è©•ä¼°', 'èªªæ˜'],
    ['ROI (æŠ•è³‡å›å ±ç‡)', `=D6/B6*100`, '%', '>100%', currentResults.youTotal/t('rent')*100 > 100 ? 'å„ªç§€' : 'ä¸€èˆ¬', 'å¹´åº¦æŠ•è³‡å›å ±'],
    ['æœˆå›å ±ç‡', `=C4/B4*100`, '%', '>8%', currentResults.youTotal/t('rent')*100/12 > 8 ? 'å„ªç§€' : 'ä¸€èˆ¬', 'æœˆåº¦æŠ•è³‡å›å ±'],
    ['å›æœ¬æœŸé–“', `=B4/C4`, 'æœˆ', '<12å€‹æœˆ', t('rent')/currentResults.youTotal < 12 ? 'å„ªç§€' : 'ä¸€èˆ¬', 'æŠ•è³‡å›æ”¶æœŸé–“'],
    ['', '', '', '', '', ''],
    ['ğŸ¯ æŠ•è³‡å„ªåŒ–å»ºè­°', '', '', '', '', ''],
    ['å„ªåŒ–æ–¹å‘', 'é æœŸæå‡', 'å¯¦æ–½é›£åº¦', 'æŠ•å…¥æˆæœ¬', 'é æœŸæ”¶ç›Š', 'å»ºè­°'],
    ['æå‡ç‡Ÿæ”¶', '+20%å›å ±ç‡', 'ä¸­ç­‰', 'ä¸­', 'é«˜', 'é‡é»ç™¼å±•'],
    ['æ§åˆ¶æˆæœ¬', '+15%å›å ±ç‡', 'å®¹æ˜“', 'ä½', 'ä¸­', 'ç«‹å³åŸ·è¡Œ'],
    ['å¢åŠ æŠ•è³‡', '+10%å›å ±ç‡', 'å›°é›£', 'é«˜', 'ä½', 'è¬¹æ…è©•ä¼°'],
    ['å„ªåŒ–åˆ†æ½¤', '+5%å›å ±ç‡', 'å®¹æ˜“', 'ä½', 'ä½', 'å®šæœŸæª¢è¨'],
    ['', '', '', '', '', ''],
    ['ğŸ“ˆ é¢¨éšªè©•ä¼°', '', '', '', '', ''],
    ['é¢¨éšªé¡å‹', 'é¢¨éšªç­‰ç´š', 'å½±éŸ¿ç¨‹åº¦', 'ç™¼ç”Ÿæ©Ÿç‡', 'æ‡‰å°ç­–ç•¥', 'ç›£æ§æŒ‡æ¨™'],
    ['ç‡Ÿæ”¶ä¸‹é™', 'ä¸­', 'é«˜', 'ä¸­', 'å¤šå…ƒåŒ–æ”¶å…¥', 'æœˆåº¦ç‡Ÿæ”¶'],
    ['æˆæœ¬ä¸Šå‡', 'ä¸­', 'ä¸­', 'é«˜', 'æˆæœ¬æ§åˆ¶', 'æˆæœ¬ä½”æ¯”'],
    ['ç«¶çˆ­åŠ åŠ‡', 'ä½', 'ä¸­', 'ä½', 'å·®ç•°åŒ–æœå‹™', 'å¸‚å ç‡'],
    ['æ”¿ç­–è®ŠåŒ–', 'ä½', 'é«˜', 'ä½', 'åˆè¦ç¶“ç‡Ÿ', 'æ³•è¦æ›´æ–°'],
    ['æŠ€è¡“è®Šé©', 'ä½', 'ä¸­', 'ä¸­', 'æŒçºŒå­¸ç¿’', 'æŠ€è¡“ç™¼å±•']
  ];
  
  const ws6 = XLSX.utils.aoa_to_sheet(roiAnalysisData);
  ws6['!cols'] = [
    {wch: 20}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 20}
  ];
  
  XLSX.utils.book_append_sheet(wb, ws6, 'æŠ•è³‡å›å ±');
  
  // ä¸‹è¼‰Excelæª”æ¡ˆ
  XLSX.writeFile(wb, 'ç¾æ¥­å…±äº«å·¥ä½œå®¤è²¡å‹™å ±è¡¨_2025.xlsx');
}

function calculate(){
  // è®€å–è¼¸å…¥å€¼
  const technicians = t('technicians'),
        clientsPerTech = t('clientsPerTech'),
        pricePerClient = t('pricePerClient'),
        publicCourses = t('publicCourses'),
        studentsPerPublic = t('studentsPerPublic'),
        mixedCourses = t('mixedCourses'),
        companyStudents = t('companyStudents'),
        courseFee = t('courseFee'),
        privateDays = t('privateDays'),
        classroomRent = t('classroomRent'),
        nailDesks = t('nailDesks'),
        nailDeskRent = t('nailDeskRent'),
        beds = t('beds'),
        bedRent = t('bedRent'),
        boxes = t('boxes'),
        boxRent = t('boxRent'),
        parkingSpots = t('parkingSpots'),
        parkingRent = t('parkingRent'),
        rent = t('rent'),
        parkingFee = t('parkingFee'),
        waterBill = t('waterBill'),
        electricBill = t('electricBill'),
        internetBill = t('internetBill'),
        accountingFee = t('accountingFee'),
        cleaningFee = t('cleaningFee'),
        insurance = t('insurance'),
        maintenance = t('maintenance'),
        marketingExpense = t('marketingExpense'),
        miscExpense = t('miscExpense');

  // æ”¶å…¥è¨ˆç®—
  const rentalIncome = nailDesks*nailDeskRent + beds*bedRent + boxes*boxRent + parkingSpots*parkingRent;
  const clientRevenue = Math.floor(technicians * clientsPerTech * pricePerClient * (3/7));
  const publicCourseRevenue = Math.floor(publicCourses * studentsPerPublic * courseFee * (3/7));
  const mixedCourseRevenue = Math.floor(mixedCourses * companyStudents * courseFee * (3/7)) + (mixedCourses * 2 * classroomRent /2);
  const privateClassRent = privateDays * classroomRent;

  const totalRevenue = rentalIncome + clientRevenue + publicCourseRevenue + mixedCourseRevenue + privateClassRent;

  // å„²å­˜è¨ˆç®—çµæœåˆ°å…¨åŸŸè®Šæ•¸
  currentResults = {
    rentalIncome,
    clientRevenue,
    publicCourseRevenue,
    mixedCourseRevenue,
    privateClassRent,
    totalRevenue
  };

  // æ”¯å‡ºè¨ˆç®—
  const totalCost = rent + parkingFee + waterBill + electricBill + internetBill + 
                   accountingFee + cleaningFee + insurance + maintenance + 
                   marketingExpense + miscExpense;
  const netProfit = totalRevenue - totalCost;
  
  // å…ˆæ‰£é™¤è¡ŒéŠ·åˆ†æ½¤20%
  const marketingBonus = Math.floor(netProfit * 0.20);
  const remainingProfit = netProfit - marketingBonus;
  
  // å‰©é¤˜åˆ©æ½¤æŒ‰è‚¡æ¬Šåˆ†é…
  const share95 = Math.floor(remainingProfit * 0.95);
  const share5 = Math.floor(remainingProfit * 0.05);
  const youTotal = share5 + marketingBonus;

  // æ›´æ–°å…¨åŸŸè®Šæ•¸
  currentResults = {
    ...currentResults,
    totalCost,
    netProfit,
    marketingBonus,
    remainingProfit,
    share95,
    share5,
    youTotal
  };

  // é¡¯ç¤ºçµæœ
  document.getElementById('incomeBox').innerHTML = `
    <h3>ğŸ“ˆ æ”¶å…¥</h3>
    <p>å…¬å¸åˆ†ç§Ÿæ”¶å…¥ï¼š${rentalIncome.toLocaleString()} å…ƒ</p>
    <p>ä¾†é›»å®¢å…¬å¸åˆ†æ½¤(3/7)ï¼š${clientRevenue.toLocaleString()} å…ƒ</p>
    <p>èª²ç¨‹æ”¶å…¥ï¼ˆå…¬æµé‡ï¼‹æ··åˆï¼Œ3/7æŠ½æˆï¼‰ï¼š${(publicCourseRevenue+mixedCourseRevenue).toLocaleString()} å…ƒ</p>
    <p>æ•™å®¤ç§Ÿé‡‘ï¼ˆç§æµé‡ï¼‰ï¼š${privateClassRent.toLocaleString()} å…ƒ</p>
    <p class="highlight">ç¸½ç‡Ÿæ”¶ï¼š${totalRevenue.toLocaleString()} å…ƒ</p>
  `;

  document.getElementById('expenseBox').innerHTML = `
    <h3>ğŸ“‰ æ”¯å‡ºæ˜ç´°</h3>
    <p>æˆ¿ç§Ÿï¼š${rent.toLocaleString()} å…ƒ</p>
    <p>è»Šä½è²»ï¼š${parkingFee.toLocaleString()} å…ƒ</p>
    <p>æ°´è²»ï¼š${waterBill.toLocaleString()} å…ƒ</p>
    <p>é›»è²»ï¼š${electricBill.toLocaleString()} å…ƒ</p>
    <p>ç¶²è·¯è²»ï¼š${internetBill.toLocaleString()} å…ƒ</p>
    <p>æœƒè¨ˆè²»ï¼š${accountingFee.toLocaleString()} å…ƒ</p>
    <p>æ¸…æ½”è²»ï¼š${cleaningFee.toLocaleString()} å…ƒ</p>
    <p>ä¿éšªè²»ï¼š${insurance.toLocaleString()} å…ƒ</p>
    <p>è¨­å‚™ç¶­è­·è²»ï¼š${maintenance.toLocaleString()} å…ƒ</p>
    <p>å»£å‘Šè€—æï¼š${marketingExpense.toLocaleString()} å…ƒ</p>
    <p>å…¶ä»–é›œæ”¯ï¼š${miscExpense.toLocaleString()} å…ƒ</p>
    <p class="highlight">ç¸½æ”¯å‡ºï¼š${totalCost.toLocaleString()} å…ƒ</p>
  `;

  document.getElementById('profitBox').innerHTML = `
    <h3>ğŸ’° ç›ˆé¤˜èˆ‡åˆ†æ½¤æµç¨‹</h3>
    
    <div class="step-title">ğŸ“Š ç¬¬1æ­¥ï¼šè¨ˆç®—ç¨…å¾Œæ·¨åˆ©</div>
    <div class="profit-step">ç¨…å¾Œæ·¨åˆ©ï¼š${netProfit.toLocaleString()} å…ƒ</div>
    
    <div class="step-title">ğŸ¯ ç¬¬2æ­¥ï¼šå…ˆæ‰£é™¤è¡ŒéŠ·åˆ†æ½¤</div>
    <div class="profit-step">è¡ŒéŠ·åˆ†æ½¤(20%)ï¼š${marketingBonus.toLocaleString()} å…ƒ</div>
    <div class="profit-step">å‰©é¤˜åˆ©æ½¤ï¼š${remainingProfit.toLocaleString()} å…ƒ</div>
    
    <div class="step-title">ğŸ‘¥ ç¬¬3æ­¥ï¼šæŒ‰è‚¡æ¬Šåˆ†é…å‰©é¤˜åˆ©æ½¤</div>
    <div class="profit-step">æ¢…éˆ´åˆ†ç´…(95%)ï¼š${share95.toLocaleString()} å…ƒ</div>
    <div class="profit-step">è”¡ï¼‹å­è²åˆ†ç´…(5%)ï¼š${share5.toLocaleString()} å…ƒ</div>
    
    <div class="final-result">
      ğŸ‰ æ¿¬ç‘’ï¼‹å­è²ç¸½æ”¶ç›Šï¼š${youTotal.toLocaleString()} å…ƒ<br>
      <small>(è‚¡æ¬Šåˆ†ç´… + è¡ŒéŠ·åˆ†æ½¤)</small>
    </div>
    
    <div class="meiling-result">
      ğŸ‘‘ æ¢…éˆ´ç¸½æ”¶ç›Šï¼š${share95.toLocaleString()} å…ƒ<br>
      <small>(95% è‚¡æ¬Šåˆ†ç´…)</small>
    </div>
  `;

}

function sensitivityAnalysis() {
  // è®€å–èª¿æ•´åƒæ•¸
  const techAdjust = t('techAdjust');
  const priceAdjust = t('priceAdjust');
  const courseAdjust = t('courseAdjust');
  
  // è®€å–åŸå§‹åƒæ•¸
  const originalTech = t('technicians');
  const originalPrice = t('pricePerClient');
  const originalCourses = t('publicCourses');
  
  // è¨ˆç®—èª¿æ•´å¾Œæ”¶å…¥
  const originalClientRevenue = Math.floor(originalTech * t('clientsPerTech') * originalPrice * (3/7));
  const adjustedClientRevenue = Math.floor(techAdjust * t('clientsPerTech') * priceAdjust * (3/7));
  
  const originalCourseRevenue = Math.floor(originalCourses * t('studentsPerPublic') * t('courseFee') * (3/7));
  const adjustedCourseRevenue = Math.floor(courseAdjust * t('studentsPerPublic') * t('courseFee') * (3/7));
  
  // å…¶ä»–æ”¶å…¥ä¿æŒä¸è®Š
  const rentalIncome = t('nailDesks')*t('nailDeskRent') + t('beds')*t('bedRent') + t('boxes')*t('boxRent') + t('parkingSpots')*t('parkingRent');
  const privateClassRent = t('privateDays') * t('classroomRent');
  
  // è¨ˆç®—ç¸½æ”¶å…¥å·®ç•°
  const originalTotalRevenue = rentalIncome + originalClientRevenue + originalCourseRevenue + privateClassRent;
  const adjustedTotalRevenue = rentalIncome + adjustedClientRevenue + adjustedCourseRevenue + privateClassRent;
  
  // è¨ˆç®—åˆ†æ½¤å·®ç•°
  const totalCost = t('rent') + t('parkingFee') + t('waterBill') + t('electricBill') + t('internetBill') + 
                   t('accountingFee') + t('cleaningFee') + t('insurance') + t('maintenance') + 
                   t('marketingExpense') + t('miscExpense');
  
  const originalNetProfit = originalTotalRevenue - totalCost;
  const adjustedNetProfit = adjustedTotalRevenue - totalCost;
  
  const originalMarketingBonus = Math.floor(originalNetProfit * 0.20);
  const adjustedMarketingBonus = Math.floor(adjustedNetProfit * 0.20);
  
  const originalRemainingProfit = originalNetProfit - originalMarketingBonus;
  const adjustedRemainingProfit = adjustedNetProfit - adjustedMarketingBonus;
  
  const originalYouTotal = Math.floor(originalRemainingProfit * 0.05) + originalMarketingBonus;
  const adjustedYouTotal = Math.floor(adjustedRemainingProfit * 0.05) + adjustedMarketingBonus;
  
  const difference = adjustedYouTotal - originalYouTotal;
  const percentChange = originalYouTotal > 0 ? ((difference / originalYouTotal) * 100) : 0;
  
  document.getElementById('sensitivityResults').innerHTML = `
    <div class="sensitivity-card">
      <h4>ğŸ“Š æ•æ„Ÿåº¦åˆ†æçµæœ</h4>
      <div class="comparison-row">
        <span>åŸå§‹åƒæ•¸ï¼š</span>
        <span>æŠ€å¸«${originalTech}äººï¼Œå®¢å–®åƒ¹${originalPrice}å…ƒï¼Œèª²ç¨‹${originalCourses}å ´</span>
      </div>
      <div class="comparison-row">
        <span>èª¿æ•´åƒæ•¸ï¼š</span>
        <span>æŠ€å¸«${techAdjust}äººï¼Œå®¢å–®åƒ¹${priceAdjust}å…ƒï¼Œèª²ç¨‹${courseAdjust}å ´</span>
      </div>
      <div class="comparison-row">
        <span>åŸå§‹ç¸½æ”¶ç›Šï¼š</span>
        <span>${originalYouTotal.toLocaleString()} å…ƒ</span>
      </div>
      <div class="comparison-row">
        <span>èª¿æ•´å¾Œç¸½æ”¶ç›Šï¼š</span>
        <span>${adjustedYouTotal.toLocaleString()} å…ƒ</span>
      </div>
      <div class="comparison-row">
        <span>æ”¶ç›Šè®ŠåŒ–ï¼š</span>
        <span style="color: ${difference >= 0 ? '#059669' : '#dc2626'}; font-weight: bold;">
          ${difference >= 0 ? '+' : ''}${difference.toLocaleString()} å…ƒ (${percentChange >= 0 ? '+' : ''}${percentChange.toFixed(1)}%)
        </span>
      </div>
    </div>
  `;
}
</script>

</body>
</html>
